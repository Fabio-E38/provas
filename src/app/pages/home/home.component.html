<div
  class="min-h-screen bg-gradient-to-br from-slate-100 via-indigo-50 to-white p-6 sm:p-8 animate-in fade-in slide-in-from-bottom-4 duration-700"
>
  <div class="max-w-6xl mx-auto space-y-8">

    <!-- â”€â”€ Header â”€â”€ -->
    <header class="flex justify-between items-center">
      <h1 class="text-xl font-bold tracking-tight" style="color: var(--brand-text)">
        Portale Supporto
      </h1>
      <div class="flex items-center gap-3">
        <span class="text-sm font-medium" style="color: var(--brand-text-muted)">
          {{ currentUser?.name }}
        </span>
        <button
          (click)="logout()"
          class="flex items-center gap-1.5 px-4 py-2 text-sm font-medium rounded-xl border transition-all hover:bg-white"
          style="color: var(--brand-text-muted); border-color: #e2e8f0"
        >
          <i-lucide name="log-out" class="w-4 h-4"></i-lucide>
          Esci
        </button>
      </div>
    </header>

    <!-- â”€â”€ Hero Section: Saluto + Search + CTA Chat â”€â”€ -->
    <section
      class="rounded-3xl p-8 sm:p-10 text-center space-y-5 relative overflow-hidden"
      style="background: var(--brand-surface-glass); backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.8)"
    >
      <div class="absolute top-0 right-0 w-48 h-48 rounded-full blur-[80px] opacity-30"
           style="background: var(--brand-primary)"></div>

      <h2 class="text-3xl sm:text-4xl font-bold" style="color: var(--brand-text)">
        Ciao, {{ currentUser?.name ?? 'Utente' }} ðŸ‘‹
      </h2>
      <p class="text-lg" style="color: var(--brand-text-muted)">
        Come posso aiutarti oggi?
      </p>

      <!-- Search bar -->
      <form (submit)="onSearchSubmit()" class="max-w-xl mx-auto relative">
        <input
          type="text"
          [(ngModel)]="searchQuery"
          placeholder="Descrivi il tuo problema..."
          class="w-full rounded-2xl px-5 py-3.5 pr-12 outline-none transition-all focus:ring-2"
          style="background: var(--brand-surface); border: 1px solid #e2e8f0; color: var(--brand-text)"
          [style.--tw-ring-color]="'var(--brand-primary)'"
        />
        <i-lucide name="search" class="absolute right-4 top-3.5 w-5 h-5" style="color: var(--brand-text-muted)"></i-lucide>
      </form>

      <!-- Primary CTA -->
      <button
        (click)="openChat()"
        class="inline-flex items-center gap-2 px-8 py-3.5 rounded-2xl text-white font-semibold text-base transition-all shadow-lg hover:shadow-xl hover:scale-[1.02]"
        style="background: var(--brand-primary); box-shadow: 0 8px 24px color-mix(in srgb, var(--brand-primary) 30%, transparent)"
      >
        <i-lucide name="message-circle" class="w-5 h-5"></i-lucide>
        Avvia Chat con il Supporto
      </button>
    </section>

    <!-- â”€â”€ Stats Row â”€â”€ -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
      <!-- Aperti -->
      <a
        routerLink="/cases"
        [queryParams]="{ status: 'Open' }"
        class="rounded-2xl p-5 transition-all hover:shadow-md cursor-pointer group"
        style="background: var(--brand-surface-glass); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.8)"
      >
        <span class="text-3xl font-bold" style="color: var(--brand-primary)">
          {{ openCount }}
        </span>
        <p class="text-sm font-medium uppercase mt-1 tracking-wide" style="color: var(--brand-text-muted)">
          Aperti
        </p>
      </a>

      <!-- In corso -->
      <a
        routerLink="/cases"
        [queryParams]="{ status: 'In Progress' }"
        class="rounded-2xl p-5 transition-all hover:shadow-md cursor-pointer group"
        style="background: var(--brand-surface-glass); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.8)"
      >
        <span class="text-3xl font-bold" style="color: var(--brand-accent)">
          {{ inProgressCount }}
        </span>
        <p class="text-sm font-medium uppercase mt-1 tracking-wide" style="color: var(--brand-text-muted)">
          In Corso
        </p>
      </a>

      <!-- Risolti -->
      <a
        routerLink="/cases"
        [queryParams]="{ status: 'Resolved' }"
        class="rounded-2xl p-5 transition-all hover:shadow-md cursor-pointer group"
        style="background: var(--brand-surface-glass); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.8)"
      >
        <span class="text-3xl font-bold" style="color: var(--brand-success)">
          {{ resolvedCount }}
        </span>
        <p class="text-sm font-medium uppercase mt-1 tracking-wide" style="color: var(--brand-text-muted)">
          Risolti
        </p>
      </a>
    </div>

    <!-- â”€â”€ Bottom Bento Grid â”€â”€ -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

      <!-- Ultimi Casi (2/3) -->
      <div
        class="lg:col-span-2 rounded-2xl p-6 space-y-4"
        style="background: var(--brand-surface-glass); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.8)"
      >
        <div class="flex justify-between items-center">
          <h3 class="text-lg font-semibold" style="color: var(--brand-text)">Ultimi Casi</h3>
          <a
            routerLink="/cases"
            class="text-sm font-medium flex items-center gap-1 transition-colors hover:underline"
            style="color: var(--brand-primary)"
          >
            Vedi tutti
            <i-lucide name="arrow-right" class="w-4 h-4"></i-lucide>
          </a>
        </div>

        <div *ngIf="recentTickets.length === 0" class="text-sm py-4" style="color: var(--brand-text-muted)">
          Nessun ticket disponibile.
        </div>

        <a
          *ngFor="let ticket of recentTickets"
          [routerLink]="['/cases', ticket.id]"
          class="flex items-center justify-between p-4 rounded-xl transition-all hover:shadow-sm"
          style="background: var(--brand-surface); border: 1px solid #f1f5f9"
        >
          <div class="flex items-center gap-3 min-w-0">
            <div class="w-9 h-9 rounded-lg flex items-center justify-center shrink-0"
                 style="background: var(--brand-primary-light)">
              <i-lucide name="file-text" class="w-4 h-4" style="color: var(--brand-primary)"></i-lucide>
            </div>
            <div class="min-w-0">
              <p class="font-medium text-sm truncate" style="color: var(--brand-text)">{{ ticket.title }}</p>
              <p class="text-xs" style="color: var(--brand-text-muted)">{{ ticket.numberId }}</p>
            </div>
          </div>
          <div class="flex items-center gap-3 shrink-0 ml-4">
            <span
              class="px-2.5 py-0.5 rounded-full text-xs font-semibold"
              [class]="ticket.priority === 'High'
                ? 'bg-red-100 text-red-700'
                : ticket.priority === 'Medium'
                  ? 'bg-amber-100 text-amber-700'
                  : 'bg-slate-100 text-slate-600'"
            >
              {{ ticket.priority }}
            </span>
            <span class="text-xs font-medium" style="color: var(--brand-text-muted)">
              {{ ticket.status }}
            </span>
          </div>
        </a>
      </div>

      <!-- Right column (1/3) -->
      <div class="space-y-6">

        <!-- Risorse Utili -->
        <div
          class="rounded-2xl p-6 space-y-3"
          style="background: var(--brand-surface-glass); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.8)"
        >
          <h3 class="text-lg font-semibold flex items-center gap-2" style="color: var(--brand-text)">
            <i-lucide name="book-open" class="w-5 h-5" style="color: var(--brand-primary)"></i-lucide>
            Risorse Utili
          </h3>
          <div
            *ngFor="let doc of kbDocuments"
            class="p-3 rounded-xl transition-all hover:shadow-sm cursor-pointer"
            style="background: var(--brand-surface); border: 1px solid #f1f5f9"
          >
            <p class="text-sm font-medium" style="color: var(--brand-text)">{{ doc.title }}</p>
            <p class="text-xs mt-0.5" style="color: var(--brand-text-muted)">{{ doc.summary }}</p>
          </div>
        </div>

        <!-- Apri Ticket Manualmente -->
        <a
          routerLink="/ticket"
          class="block rounded-2xl p-6 transition-all hover:shadow-md group"
          style="background: var(--brand-surface-glass); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.8)"
        >
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl flex items-center justify-center"
                 style="background: var(--brand-primary-light)">
              <i-lucide name="pen-line" class="w-5 h-5" style="color: var(--brand-primary)"></i-lucide>
            </div>
            <div>
              <p class="text-sm font-semibold" style="color: var(--brand-text)">Apri Ticket Manualmente</p>
              <p class="text-xs" style="color: var(--brand-text-muted)">Preferisci compilare tu? Vai al form.</p>
            </div>
          </div>
        </a>

      </div><!-- /right column -->
    </div><!-- /bento grid -->

  </div><!-- /max-w container -->
</div>
